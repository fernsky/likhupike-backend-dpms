<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext 
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd 
                      http://www.liquibase.org/xml/ns/dbchangelog 
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- Link the MANAGE_DEMOGRAPHICS permission to the System Administrator role -->
    <changeSet author="dpis" id="01-sys-admin-manage-demographics-permission">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="role_permissions"/>
                <tableExists tableName="roles"/>
                <tableExists tableName="permissions"/>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM roles WHERE type = 'SYSTEM_ADMINISTRATOR'</sqlCheck>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM permissions WHERE type = 'MANAGE_DEMOGRAPHICS'</sqlCheck>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM role_permissions 
                    WHERE role_type = 'SYSTEM_ADMINISTRATOR' AND permission_type = 'MANAGE_DEMOGRAPHICS'
                </sqlCheck>
            </and>
        </preConditions>
        <insert tableName="role_permissions">
            <column name="id" value="a8b7c6d5-e4f3-2g1h-0i9j-8k7l6m5n4o3p"/>
            <column name="role_type" value="SYSTEM_ADMINISTRATOR"/>
            <column name="permission_type" value="MANAGE_DEMOGRAPHICS"/>
        </insert>
        <comment>Add MANAGE_DEMOGRAPHICS permission to System Administrator role</comment>
    </changeSet>

    <!-- Link individual demographic permissions to the System Administrator role -->
    <changeSet author="dpis" id="02-sys-admin-view-demographic-data-permission">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="role_permissions"/>
                <tableExists tableName="roles"/>
                <tableExists tableName="permissions"/>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM roles WHERE type = 'SYSTEM_ADMINISTRATOR'</sqlCheck>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM permissions WHERE type = 'VIEW_DEMOGRAPHIC_DATA'</sqlCheck>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM role_permissions 
                    WHERE role_type = 'SYSTEM_ADMINISTRATOR' AND permission_type = 'VIEW_DEMOGRAPHIC_DATA'
                </sqlCheck>
            </and>
        </preConditions>
        <insert tableName="role_permissions">
            <column name="id" value="p3o4n5m6-l7k8-j9i0-h1g2-f3e4d5c6b7a8"/>
            <column name="role_type" value="SYSTEM_ADMINISTRATOR"/>
            <column name="permission_type" value="VIEW_DEMOGRAPHIC_DATA"/>
        </insert>
        <comment>Add VIEW_DEMOGRAPHIC_DATA permission to System Administrator role</comment>
    </changeSet>

    <changeSet author="dpis" id="03-sys-admin-create-demographic-data-permission">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="role_permissions"/>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM permissions WHERE type = 'CREATE_DEMOGRAPHIC_DATA'</sqlCheck>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM role_permissions 
                    WHERE role_type = 'SYSTEM_ADMINISTRATOR' AND permission_type = 'CREATE_DEMOGRAPHIC_DATA'
                </sqlCheck>
            </and>
        </preConditions>
        <insert tableName="role_permissions">
            <column name="id" value="q1w2e3r4-t5y6-u7i8-o9p0-a1s2d3f4g5h6"/>
            <column name="role_type" value="SYSTEM_ADMINISTRATOR"/>
            <column name="permission_type" value="CREATE_DEMOGRAPHIC_DATA"/>
        </insert>
        <comment>Add CREATE_DEMOGRAPHIC_DATA permission to System Administrator role</comment>
    </changeSet>

    <changeSet author="dpis" id="04-sys-admin-update-demographic-data-permission">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="role_permissions"/>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM permissions WHERE type = 'UPDATE_DEMOGRAPHIC_DATA'</sqlCheck>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM role_permissions 
                    WHERE role_type = 'SYSTEM_ADMINISTRATOR' AND permission_type = 'UPDATE_DEMOGRAPHIC_DATA'
                </sqlCheck>
            </and>
        </preConditions>
        <insert tableName="role_permissions">
            <column name="id" value="j7k8l9m0-n1b2-v3c4-x5z6-a7s8d9f0g1h2"/>
            <column name="role_type" value="SYSTEM_ADMINISTRATOR"/>
            <column name="permission_type" value="UPDATE_DEMOGRAPHIC_DATA"/>
        </insert>
        <comment>Add UPDATE_DEMOGRAPHIC_DATA permission to System Administrator role</comment>
    </changeSet>

    <changeSet author="dpis" id="05-sys-admin-delete-demographic-data-permission">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="role_permissions"/>
                <sqlCheck expectedResult="1">SELECT COUNT(*) FROM permissions WHERE type = 'DELETE_DEMOGRAPHIC_DATA'</sqlCheck>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM role_permissions 
                    WHERE role_type = 'SYSTEM_ADMINISTRATOR' AND permission_type = 'DELETE_DEMOGRAPHIC_DATA'
                </sqlCheck>
            </and>
        </preConditions>
        <insert tableName="role_permissions">
            <column name="id" value="r3t4y5u6-i7o8-p9a0-s1d2-f3g4h5j6k7l8"/>
            <column name="role_type" value="SYSTEM_ADMINISTRATOR"/>
            <column name="permission_type" value="DELETE_DEMOGRAPHIC_DATA"/>
        </insert>
        <comment>Add DELETE_DEMOGRAPHIC_DATA permission to System Administrator role</comment>
    </changeSet>

</databaseChangeLog>
