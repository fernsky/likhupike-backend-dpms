=== Core Domain Models

This section describes the foundational data models that serve as building blocks for the Digital Profile Information System.

==== `BaseEntity`
Abstract base class providing common attributes for all entities in the system.

[cols="1,3", options="header"]
|===
| Field        | Description
| `id`         | Unique identifier (UUID) for the entity
| `createdAt`  | Timestamp when the entity was created
| `createdBy`  | Reference to the user who created the entity
| `updatedAt`  | Timestamp when the entity was last updated
| `updatedBy`  | Reference to the user who last updated the entity
| `version`    | Optimistic locking version number for concurrency control
| `entityHash` | Cryptographic hash of entity content for integrity validation
| `origin`     | Source system or integration point where entity was created
| `externalId` | Optional ID reference in external systems for integrations
| `tenant`     | Optional reference to tenant in multi-tenant deployments
|===

==== `SoftDeletableEntity`
Extends BaseEntity with soft deletion capabilities.

[cols="1,3", options="header"]
|===
| Field            | Description
| `isDeleted`      | Flag indicating whether the entity has been soft-deleted
| `deletedAt`      | Timestamp when the entity was soft-deleted
| `deletedBy`      | Reference to the user who soft-deleted the entity
| `deletionReason` | Optional reason for deletion
| `restoredAt`     | Timestamp if the entity was restored after deletion
| `restoredBy`     | Reference to the user who restored the entity after deletion
|===

==== `ApprovableEntity`
Extends SoftDeletableEntity with approval workflow capabilities.

[cols="1,3", options="header"]
|===
| Field                  | Description
| `isApproved`           | Flag indicating whether the entity has been approved
| `approvedAt`           | Timestamp when the entity was approved
| `approvedBy`           | Reference to the user who approved the entity
| `reviewState`          | Current state in the review workflow (reference to ReviewState)
| `reviewNote`           | Optional note providing context about the review decision
| `workflowInstanceId`   | Reference to a workflow instance if using external workflow engine
| `currentAssignee`      | Reference to the user currently assigned in the workflow
| `previousReviewers`    | Collection of users who previously reviewed this entity
| `escalationLevel`      | Current escalation level for approval (0 = normal, 1+ = escalated)
| `dueDate`              | Optional deadline for the current review state
| `priorityLevel`        | Priority level for this approval (LOW, MEDIUM, HIGH, URGENT)
| `resubmissionCount`    | Count of how many times entity was resubmitted after rejection
|===

==== `ReviewState`
Enumeration for entity review workflow states.

[cols="1,3", options="header"]
|===
| Value                | Description
| `DRAFT`              | Entity is in draft state, not yet submitted for review
| `PENDING`            | Entity is awaiting initial review
| `IN_REVIEW`          | Entity is currently being reviewed
| `ACTION_NEEDED`      | Entity needs modification before approval
| `APPROVED`           | Entity has been reviewed and approved
| `REJECTED`           | Entity has been reviewed and rejected
| `ESCALATED`          | Entity has been escalated to higher authority for review
| `RECALLED`           | Entity has been recalled by the submitter
| `ON_HOLD`            | Review process temporarily paused
| `EXPIRED`            | Review process has expired due to time constraints
| `CANCELLED`          | Review process was cancelled
|===

==== `EntityVersion`
Tracks historical versions of entities for audit and compliance.

[cols="1,3", options="header"]
|===
| Field           | Description
| `entityId`      | Reference to the entity this version belongs to
| `entityType`    | Type of entity being versioned
| `versionNumber` | Sequential version number
| `createdAt`     | Timestamp when this version was created
| `createdBy`     | User who created this version
| `changeType`    | Type of change (CREATE, UPDATE, DELETE, RESTORE)
| `changeReason`  | Optional reason for the change
| `serializedData`| JSON or binary serialization of entity state at this version
| `diff`          | Optional JSON patch showing changes from previous version
|===

==== `EntityAuditEvent`
Records detailed audit events for entities beyond basic tracking.

[cols="1,3", options="header"]
|===
| Field           | Description
| `entityId`      | Reference to the entity this audit event relates to
| `entityType`    | Type of entity being audited
| `eventType`     | Type of event (VIEW, EXPORT, PRINT, etc.)
| `timestamp`     | When the event occurred
| `user`          | User who triggered the event
| `ipAddress`     | IP address from which the event originated
| `userAgent`     | Browser/client information
| `sessionId`     | Session identifier
| `metadata`      | Additional context-specific metadata about the event
|===

==== `LocalizedEntity`
Extends BaseEntity with internationalization capabilities.

[cols="1,3", options="header"]
|===
| Field                | Description
| `defaultLocale`      | Default locale for this entity's content
| `translationKeys`    | Collection of translation keys associated with this entity
| `availableLanguages` | Languages for which translations exist
| `translationLock`    | Optional lock to prevent concurrent translation updates
| `lastTranslated`     | Timestamp when entity was last translated
| `autoTranslate`      | Whether to automatically translate to new supported languages
|===

==== `SpatialEntity`
Abstract base class for entities with geographic components.

[cols="1,3", options="header"]
|===
| Field                | Description
| `point`              | Geographic point location (longitude, latitude)
| `polygon`            | Geographic boundary represented as a polygon
| `centroid`           | Calculated center point of the entity
| `area`               | Calculated area covered by the entity in square meters
| `elevation`          | Elevation above sea level in meters
| `spatialReference`   | Coordinate reference system identifier
| `accuracy`           | Accuracy of spatial data in meters
| `source`             | Source of spatial data (GPS, SURVEY, MAP, etc.)
| `lastGeometryUpdate` | When the spatial data was last updated
|===

==== `NamedEntity`
Abstract base class for entities with name and description.

[cols="1,3", options="header"]
|===
| Field                | Description
| `name`               | Primary name of the entity
| `nameTranslationKey` | Reference to name translation key for localization
| `description`        | Textual description of the entity
| `descTranslationKey` | Reference to description translation key for localization
| `slug`               | URL-friendly unique identifier derived from name
| `code`               | Optional system code for the entity (for integration purposes)
| `displayName`        | Optional formatted display name different from primary name
| `shortName`          | Optional abbreviated name for space-constrained displays
| `searchableText`     | Denormalized text optimized for full-text search
| `sortableName`       | Name form used for natural sorting (e.g., without articles)
|===

==== `MediaEntity`
Abstract base class for entities with associated media.

[cols="1,3", options="header"]
|===
| Field               | Description
| `primaryPhotoKey`   | Storage key for primary photo/image
| `photoKeys`         | Collection of storage keys for additional photos
| `videoKeys`         | Collection of storage keys for videos
| `documentKeys`      | Collection of storage keys for documents
| `thumbnailKey`      | Storage key for thumbnail image
| `coverImageKey`     | Storage key for cover image
| `totalStorageUsed`  | Total storage space used by media in bytes
| `mediaMetadata`     | JSON metadata about media files (dimensions, format, etc.)
| `lastMediaUpdate`   | Timestamp when media was last updated
| `mediaPermissions`  | Permission settings for associated media
| `cdnUrls`           | Precomputed CDN URLs for frequently accessed media
|===

==== `TenantAware`
Mixin interface for entities that support multi-tenancy.

[cols="1,3", options="header"]
|===
| Field                | Description
| `tenant`             | Reference to the tenant this entity belongs to
| `tenantPath`         | Hierarchical path in tenant tree for nested tenancy
| `crossTenantVisible` | Whether this entity is visible across tenants
| `tenantSpecificRules`| JSON configuration for tenant-specific behaviors
|===

==== `Cacheable`
Mixin interface for entities supporting cache optimization.

[cols="1,3", options="header"]
|===
| Field                | Description
| `cacheKey`           | Unique key for caching this entity
| `cacheExpiresAt`     | When cached entity should expire
| `cacheVersion`       | Version identifier for cache invalidation
| `lastCacheInvalidation` | Timestamp when cache was last invalidated
|===

==== `AuditableAction`
Records specific actions performed on entities for comprehensive audit trails.

[cols="1,3", options="header"]
|===
| Field           | Description
| `actionType`    | Type of action performed (CREATE, READ, UPDATE, DELETE, APPROVE, etc.)
| `entityType`    | Type of entity on which the action was performed
| `entityId`      | ID of the entity on which the action was performed
| `performedBy`   | User who performed the action
| `performedAt`   | Timestamp when the action was performed
| `ipAddress`     | IP address from which the action was initiated
| `userAgent`     | User agent information from which the action was initiated
| `changes`       | JSON representation of changes made (for UPDATE actions)
| `notes`         | Optional notes providing context about the action
| `sessionId`     | Session identifier for tracking user journey
| `transactionId` | Correlation ID for grouping related operations
| `applicationModule` | Module or component where action originated
| `success`       | Whether the action completed successfully
| `duration`      | Time taken to complete the action in milliseconds
| `riskLevel`     | Assessed risk level of the action (LOW, MEDIUM, HIGH)
|===

==== `AddressComponent`
Embeddable component for structured address information.

[cols="1,3", options="header"]
|===
| Field                 | Description
| `provinceCode`        | Reference code to province/state
| `districtCode`        | Reference code to district/county
| `municipalityCode`    | Reference code to municipality/city
| `wardNumber`          | Ward number within the municipality
| `wardMunicipalityCode`| Combined ward and municipality reference
| `streetAddress`       | Detailed street address
| `postalCode`          | Postal/ZIP code
| `formattedAddress`    | Complete formatted address string
| `addressType`         | Type of address (e.g., PERMANENT, TEMPORARY, BUSINESS)
| `validatedAt`         | When address was last validated
| `validatedMethod`     | Method used for address validation
| `geoCodedAt`          | When address was last geocoded
| `geoAccuracy`         | Accuracy of geocoding in meters
| `deliveryNotes`       | Special instructions for physical delivery
| `isActive`            | Whether this address is currently active
|===

==== `ContactInformation`
Embeddable component for contact details.

[cols="1,3", options="header"]
|===
| Field                | Description
| `email`              | Primary email address
| `alternateEmail`     | Secondary email address
| `phoneNumber`        | Primary phone number
| `mobileNumber`       | Mobile phone number
| `faxNumber`          | Fax number
| `websiteUrl`         | Website URL
| `socialMediaUrls`    | Collection of social media profile URLs
| `preferredContactMethod` | Preferred way to contact (EMAIL, PHONE, SMS, etc.)
| `contactAvailability`| JSON representation of availability windows
| `emailVerified`      | Whether primary email has been verified
| `phoneVerified`      | Whether primary phone has been verified
| `lastVerificationAttempt` | Timestamp of last verification attempt
| `verificationExpiry` | When current verification expires
| `doNotContact`       | Whether entity has requested no contact
|===

==== `SEOAttributes`
Embeddable component for search engine optimization data.

[cols="1,3", options="header"]
|===
| Field               | Description
| `metaTitle`         | Custom SEO title (falls back to entity name if not specified)
| `metaDescription`   | SEO meta description
| `metaKeywords`      | SEO meta keywords
| `canonicalUrl`      | Canonical URL for this entity
| `ogTitle`           | Open Graph title for social sharing
| `ogDescription`     | Open Graph description for social sharing
| `ogImageKey`        | Storage key for Open Graph image
| `twitterCardType`   | Twitter card type (summary, summary_large_image, etc.)
| `structuredData`    | JSON-LD structured data for rich search results
| `indexingDirectives`| Search engine indexing directives (noindex, nofollow, etc.)
| `lastIndexedAt`     | When search engines last indexed this entity
| `searchRank`        | Custom search ranking boost factor
| `sitemapPriority`   | Priority for inclusion in sitemap (0.0-1.0)
| `sitemapChangeFreq` | Change frequency for sitemap (hourly, daily, weekly, etc.)
|===

==== `OperationalHours`
Embeddable component for storing operational hours information.

[cols="1,3", options="header"]
|===
| Field               | Description
| `dayOfWeek`         | Day of the week (MONDAY, TUESDAY, etc.)
| `openTime`          | Opening time
| `closeTime`         | Closing time
| `isClosed`          | Whether the entity is closed on this day
| `breakStartTime`    | Start time for break/lunch period
| `breakEndTime`      | End time for break/lunch period
| `specialNotes`      | Any special notes about operations on this day
| `isHoliday`         | Whether this day is a recurring holiday
| `seasonalAdjustment`| Adjustment for seasonal hours changes
| `timeZone`          | Time zone for these operational hours
|===

==== `EventSourcingCapable`
Interface for entities supporting event sourcing pattern.

[source,kotlin]
----
interface EventSourcingCapable {
    fun getEventStream(): List<DomainEvent>
    fun applyEvent(event: DomainEvent)
    fun getCurrentState(): Map<String, Any>
    fun rebuildFromEvents(events: List<DomainEvent>)
    fun getLastEventSequence(): Long
}
----

==== `DomainEvent`
Base class for domain events in event sourcing.

[cols="1,3", options="header"]
|===
| Field               | Description
| `eventId`           | Unique identifier for the event
| `entityId`          | ID of the entity this event relates to
| `entityType`        | Type of entity this event relates to
| `eventType`         | Type of event (entity-specific)
| `timestamp`         | When the event occurred
| `actorId`           | User who triggered the event
| `sequenceNumber`    | Sequential number for ordering events
| `payload`           | JSON payload containing event details
| `metadata`          | Additional contextual metadata
| `version`           | Schema version of the event
|===

==== `TaggableEntity`
Mixin interface for entities that can be tagged for categorization.

[cols="1,3", options="header"]
|===
| Field     | Description
| `tags`    | Collection of tags associated with the entity
|===

==== `Taggable`
Interface marking an entity as taggable with methods for tag management.

[source,kotlin]
----
interface Taggable {
    fun getTags(): Set<Tag>
    fun addTag(tag: Tag)
    fun removeTag(tag: Tag)
    fun hasTag(tagName: String): Boolean
    fun getTagsByCategory(category: String): Set<Tag>
    fun getTagsAsString(): String
    fun setTagsFromString(tagString: String, delimiter: String = ",")
    fun clearAllTags()
}
----

==== `Tag`
Represents a categorization tag that can be applied to entities.

[cols="1,3", options="header"]
|===
| Field          | Description
| `name`         | Name of the tag
| `description`  | Optional description of the tag
| `category`     | Optional category for grouping related tags
| `slug`         | URL-friendly version of the tag name
| `color`        | Optional color code for visual representation
| `icon`         | Optional icon identifier for visual representation
| `parentTag`    | Optional reference to parent tag for hierarchical tagging
| `weight`       | Optional weight for controlling tag importance/ordering
| `createdBy`    | User who created this tag
| `isSystemTag`  | Whether this is a system-defined tag (vs. user-defined)
| `usageCount`   | Number of entities using this tag
|===

==== `Subscribable`
Interface for entities that support subscription capabilities.

[source,kotlin]
----
interface Subscribable {
    fun getSubscribers(): Set<User>
    fun addSubscriber(user: User, notificationType: NotificationType)
    fun removeSubscriber(user: User)
    fun notifySubscribers(eventType: String, data: Map<String, Any>)
    fun isUserSubscribed(user: User): Boolean
}
----

==== `NotificationType`
Enumeration for types of notifications users can subscribe to.

[cols="1,3", options="header"]
|===
| Value                | Description
| `ALL_CHANGES`        | Notify on all entity changes
| `MAJOR_CHANGES`      | Notify only on significant changes
| `STATUS_CHANGES`     | Notify only on status/state changes
| `COMMENTS_ONLY`      | Notify only when comments are added
| `APPROVALS_ONLY`     | Notify only for approval events
| `MENTIONS`           | Notify only when user is mentioned
| `DIGEST`             | Periodic digest of all changes
|===

==== `AccessControlled`
Interface for entities with fine-grained access control.

[source,kotlin]
----
interface AccessControlled {
    fun getOwner(): User
    fun getAccessControlList(): Set<AccessControlEntry>
    fun hasPermission(user: User, permission: Permission): Boolean
    fun grantPermission(user: User, permission: Permission)
    fun revokePermission(user: User, permission: Permission)
    fun getEffectivePermissions(user: User): Set<Permission>
}
----

==== `AccessControlEntry`
Represents a permission assignment for an entity.

[cols="1,3", options="header"]
|===
| Field           | Description
| `entity`        | Entity this ACE applies to
| `principal`     | User or group this entry applies to
| `permission`    | Permission being granted
| `grantedBy`     | User who granted this permission
| `grantedAt`     | When this permission was granted
| `expiresAt`     | When this permission expires (if temporary)
| `conditions`    | Optional conditions for when permission applies
|===

==== `Permission`
Enumeration of possible permissions for access control.

[cols="1,3", options="header"]
|===
| Value          | Description
| `VIEW`         | Permission to view/read the entity
| `EDIT`         | Permission to modify the entity
| `DELETE`       | Permission to delete the entity
| `APPROVE`      | Permission to approve/reject the entity
| `SHARE`        | Permission to share the entity with others
| `EXPORT`       | Permission to export the entity
| `ADMIN`        | Full administrative control of the entity
| `COMMENT`      | Permission to add comments
|===
