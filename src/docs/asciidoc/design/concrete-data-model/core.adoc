=== Core Domain Models

This section describes the foundational data models that serve as building blocks for the Digital Profile Information System.

==== Domain Model Integration Overview

[plantuml]
----
@startuml
skinparam linetype ortho

package "Core Entity Hierarchy" {
  abstract class BaseEntity
  abstract class SoftDeletableEntity
  abstract class ApprovableEntity
  abstract class NamedEntity
  abstract class MediaEntity
  abstract class PublishableEntity
  abstract class EncryptedEntity
  abstract class WorkflowEntity
  abstract class ReferenceDataEntity
  abstract class SpatialEntity
  abstract class LocalizedEntity
  
  BaseEntity <|-- SoftDeletableEntity
  SoftDeletableEntity <|-- ApprovableEntity
  BaseEntity <|-- NamedEntity
  BaseEntity <|-- MediaEntity
  ApprovableEntity <|-- PublishableEntity
  SoftDeletableEntity <|-- EncryptedEntity
  ApprovableEntity <|-- WorkflowEntity
  NamedEntity <|-- ReferenceDataEntity
  BaseEntity <|-- SpatialEntity
  BaseEntity <|-- LocalizedEntity
}

package "Core Capabilities" {
  interface Taggable
  interface AccessControlled
  interface Subscribable
  interface HistoryViewable
  interface EventSourcingCapable
  interface BiometricVerifiable
  interface MobileAccessible
  interface FullTextSearchable
  interface ImportableEntity
  interface ExportableEntity
  interface BatchProcessable
  interface CustomValidatable
  interface FaultTolerant
  interface AnalyticsTrackable
  interface ComplianceAuditable
  interface ExternalSystemSyncable
  interface WebhookTriggerable
}

package "Embedded Components" {
  class AddressComponent
  class ContactInformation
  class SEOAttributes
  class OperationalHours
}

package "Cross-Cutting" {
  class EntityVersion
  class EntityAuditEvent
  class AuditableAction
  class DomainEvent
  class Tag
  class AccessControlEntry
  class DataRetentionPolicy
}

ApprovableEntity -- ReviewState
Taggable -- Tag
AccessControlled -- AccessControlEntry
AccessControlled -- Permission
EventSourcingCapable -- DomainEvent
Subscribable -- NotificationType
BiometricVerifiable -- BiometricType
MobileAccessible -- OfflineCapability
PublishableEntity -- VersioningStrategy

@enduml
----

==== Component Integration Strategy

The Digital Profile Information System follows these integration patterns:

1. *Core Entity Inheritance Hierarchy* - A clear entity inheritance structure starting with BaseEntity
2. *Capability Interfaces* - Domain capabilities implemented via interfaces for composition over inheritance
3. *Value Objects and Embeddables* - Reusable components that can be embedded in multiple entities
4. *Cross-Cutting Concerns* - Domain-wide structures for auditing, versioning, events, and access control
5. *Domain Events* - Event-driven communication between bounded contexts

==== Integration Patterns

===== Composition over Inheritance

Entities combine base classes with capability interfaces:

[source,kotlin]
----
// Example of composition pattern
class CitizenProfile : 
    NamedEntity(),                // Base structure 
    SoftDeletableEntity(),        // Deletion capability
    EncryptedEntity(),            // Security capability
    BiometricVerifiable,          // Verification capability 
    MobileAccessible,             // Mobile access capability
    ComplianceAuditable {         // Compliance capability
    
    // Embedded components
    var address: AddressComponent? = null
    var contactInfo: ContactInformation? = null
    
    // Entity-specific fields
    var citizenId: String? = null
    var dateOfBirth: LocalDate? = null
    
    // Implementation of capability interfaces
    override fun getBiometricVerificationTypes(): Set<BiometricType> { ... }
    override fun getMobileViewConfiguration(): MobileViewConfig { ... }
    // Other implementations...
}
----

===== Bounded Contexts and Aggregates

The system is divided into bounded contexts with clear aggregate roots:

* *Citizen Context* - CitizenProfile as aggregate root
* *Land Context* - LandParcel as aggregate root
* *Document Context* - Document as aggregate root
* *Organization Context* - Organization as aggregate root

===== Cross-Context Integration

Contexts integrate through:

1. *Domain Events* - Loosely coupled communication
2. *Shared Kernel* - Common core models (this document)
3. *Context Maps* - Explicit relationships between contexts

==== Domain Event Flow

[plantuml]
----
@startuml
!define RECTANGLE class

RECTANGLE "Citizen Profile Created" as CPC
RECTANGLE "Document Uploaded" as DU
RECTANGLE "Verification Requested" as VR
RECTANGLE "Verification Completed" as VC
RECTANGLE "Profile Approved" as PA

CPC --> DU : triggers
DU --> VR : may trigger
VR --> VC : followed by
VC --> PA : may lead to

@enduml
----

==== Enhanced Integration Examples

===== Entity Lifecycle Management

The following diagram demonstrates the lifecycle of managed entities:

[plantuml]
----
@startuml
[*] --> Created : create()
Created --> InReview : submit()
InReview --> NeedsChanges : requestChanges()
InReview --> Approved : approve()
NeedsChanges --> InReview : resubmit()
Approved --> Published : publish()
Published --> Unpublished : unpublish()
Approved --> InReview : revise()
Unpublished --> [*] : delete()
Published --> [*] : delete()
@enduml
----

===== Cross-Entity Validations

Entities can participate in cross-entity validation rules:

[source,kotlin]
----
// Cross-entity validation example
class ValidationService {
    fun validateCitizenWithProperty(citizen: CitizenProfile, property: LandParcel): ValidationResult {
        // Complex validation rules spanning entities
        val addressMatches = citizen.address?.municipalityCode == property.municipalityCode
        val ageValid = citizen.calculateAge() >= 18
        val ownershipProofValid = verifyDocuments(citizen, property)
        
        // Return comprehensive validation result
        return ValidationResult(
            isValid = addressMatches && ageValid && ownershipProofValid,
            violations = buildViolationsList(addressMatches, ageValid, ownershipProofValid)
        )
    }
}
----

===== Query Optimization Strategies

The domain model supports efficient querying through:

1. *Denormalized Fields* - Pre-computed fields for frequent queries
2. *Caching Strategies* - Time and version-based cache invalidation
3. *Materialized Views* - For complex reporting needs
4. *Search Indexes* - For full-text search capabilities

[source,kotlin]
----
// Query optimization example
interface EntityRepository<T : BaseEntity> {
    // Standard queries
    fun findById(id: UUID): T?
    
    // Optimized for read-heavy operations
    fun findByIdCached(id: UUID): T?
    
    // Specialized search methods
    fun search(query: String, filters: Map<String, Any>): List<T>
    
    // Denormalized aggregates
    fun getStatisticsSummary(): StatisticsSummary
}
----

==== Integration with External Systems

The domain model establishes patterns for external integration:

1. *Adapters* - Convert between internal and external models
2. *Synchronization* - Bidirectional sync with external systems
3. *Webhooks* - Event notifications to external systems
4. *Import/Export* - Standardized data exchange formats

[plantuml]
----
@startuml
actor User
component "Digital Profile System" as DPS
database "Internal DB" as DB
cloud "External Systems" as ES
cloud "Mobile Apps" as MA

User --> DPS
DPS <--> DB
DPS <--> ES : APIs, Webhooks, \nETL Processes
DPS <--> MA : Mobile API, \nOffline Sync

@enduml
----

==== Domain Security Integration

Security is integrated throughout the domain model:

1. *Entity-Level Encryption* - Via EncryptedEntity base class
2. *Field-Level Encryption* - For sensitive fields
3. *Access Control* - Via AccessControlled interface
4. *Biometric Verification* - Via BiometricVerifiable interface
5. *Audit Trails* - Comprehensive action logging
6. *Data Classification* - Security levels for data

==== Version Control and Change Management

The domain incorporates enterprise-grade version control:

1. *Entity Versions* - Complete version history
2. *Change Tracking* - Field-level change detection
3. *Approval Workflows* - Multi-level review processes
4. *Conflict Resolution* - Strategies for concurrent modifications

==== Data Governance Integration

The domain model supports data governance through:

1. *Data Retention Policies* - Lifecycle management
2. *Compliance Frameworks* - Regulatory requirements tracking
3. *Data Lineage* - Origin and transformation tracking
4. *Quality Metrics* - Data quality measurement

==== Scalability Patterns

The domain model implements patterns for horizontal scaling:

1. *Tenant Isolation* - Via TenantAware interface
2. *Sharding Support* - Entity design compatible with data sharding
3. *Eventual Consistency* - Event-based synchronization
4. *CQRS* - Separation of read and write models

==== `BaseEntity`
Abstract base class providing common attributes for all entities in the system.

[cols="1,3", options="header"]
|===
| Field        | Description
| `id`         | Unique identifier (UUID) for the entity
| `createdAt`  | Timestamp when the entity was created
| `createdBy`  | Reference to the user who created the entity
| `updatedAt`  | Timestamp when the entity was last updated
| `updatedBy`  | Reference to the user who last updated the entity
| `version`    | Optimistic locking version number for concurrency control
| `entityHash` | Cryptographic hash of entity content for integrity validation
| `origin`     | Source system or integration point where entity was created
| `externalId` | Optional ID reference in external systems for integrations
| `tenant`     | Optional reference to tenant in multi-tenant deployments
|===

==== `SoftDeletableEntity`
Extends BaseEntity with soft deletion capabilities.

[cols="1,3", options="header"]
|===
| Field            | Description
| `isDeleted`      | Flag indicating whether the entity has been soft-deleted
| `deletedAt`      | Timestamp when the entity was soft-deleted
| `deletedBy`      | Reference to the user who soft-deleted the entity
| `deletionReason` | Optional reason for deletion
| `restoredAt`     | Timestamp if the entity was restored after deletion
| `restoredBy`     | Reference to the user who restored the entity after deletion
|===

==== `ApprovableEntity`
Extends SoftDeletableEntity with approval workflow capabilities.

[cols="1,3", options="header"]
|===
| Field                  | Description
| `isApproved`           | Flag indicating whether the entity has been approved
| `approvedAt`           | Timestamp when the entity was approved
| `approvedBy`           | Reference to the user who approved the entity
| `reviewState`          | Current state in the review workflow (reference to ReviewState)
| `reviewNote`           | Optional note providing context about the review decision
| `workflowInstanceId`   | Reference to a workflow instance if using external workflow engine
| `currentAssignee`      | Reference to the user currently assigned in the workflow
| `previousReviewers`    | Collection of users who previously reviewed this entity
| `escalationLevel`      | Current escalation level for approval (0 = normal, 1+ = escalated)
| `dueDate`              | Optional deadline for the current review state
| `priorityLevel`        | Priority level for this approval (LOW, MEDIUM, HIGH, URGENT)
| `resubmissionCount`    | Count of how many times entity was resubmitted after rejection
|===

==== `ReviewState`
Enumeration for entity review workflow states.

[cols="1,3", options="header"]
|===
| Value                | Description
| `DRAFT`              | Entity is in draft state, not yet submitted for review
| `PENDING`            | Entity is awaiting initial review
| `IN_REVIEW`          | Entity is currently being reviewed
| `ACTION_NEEDED`      | Entity needs modification before approval
| `APPROVED`           | Entity has been reviewed and approved
| `REJECTED`           | Entity has been reviewed and rejected
| `ESCALATED`          | Entity has been escalated to higher authority for review
| `RECALLED`           | Entity has been recalled by the submitter
| `ON_HOLD`            | Review process temporarily paused
| `EXPIRED`            | Review process has expired due to time constraints
| `CANCELLED`          | Review process was cancelled
|===

==== `EntityVersion`
Tracks historical versions of entities for audit and compliance.

[cols="1,3", options="header"]
|===
| Field           | Description
| `entityId`      | Reference to the entity this version belongs to
| `entityType`    | Type of entity being versioned
| `versionNumber` | Sequential version number
| `createdAt`     | Timestamp when this version was created
| `createdBy`     | User who created this version
| `changeType`    | Type of change (CREATE, UPDATE, DELETE, RESTORE)
| `changeReason`  | Optional reason for the change
| `serializedData`| JSON or binary serialization of entity state at this version
| `diff`          | Optional JSON patch showing changes from previous version
|===

==== `EntityAuditEvent`
Records detailed audit events for entities beyond basic tracking.

[cols="1,3", options="header"]
|===
| Field           | Description
| `entityId`      | Reference to the entity this audit event relates to
| `entityType`    | Type of entity being audited
| `eventType`     | Type of event (VIEW, EXPORT, PRINT, etc.)
| `timestamp`     | When the event occurred
| `user`          | User who triggered the event
| `ipAddress`     | IP address from which the event originated
| `userAgent`     | Browser/client information
| `sessionId`     | Session identifier
| `metadata`      | Additional context-specific metadata about the event
|===

==== `LocalizedEntity`
Extends BaseEntity with internationalization capabilities.

[cols="1,3", options="header"]
|===
| Field                | Description
| `defaultLocale`      | Default locale for this entity's content
| `translationKeys`    | Collection of translation keys associated with this entity
| `availableLanguages` | Languages for which translations exist
| `translationLock`    | Optional lock to prevent concurrent translation updates
| `lastTranslated`     | Timestamp when entity was last translated
| `autoTranslate`      | Whether to automatically translate to new supported languages
|===

==== `SpatialEntity`
Abstract base class for entities with geographic components.

[cols="1,3", options="header"]
|===
| Field                | Description
| `point`              | Geographic point location (longitude, latitude)
| `polygon`            | Geographic boundary represented as a polygon
| `centroid`           | Calculated center point of the entity
| `area`               | Calculated area covered by the entity in square meters
| `elevation`          | Elevation above sea level in meters
| `spatialReference`   | Coordinate reference system identifier
| `accuracy`           | Accuracy of spatial data in meters
| `source`             | Source of spatial data (GPS, SURVEY, MAP, etc.)
| `lastGeometryUpdate` | When the spatial data was last updated
|===

==== `NamedEntity`
Abstract base class for entities with name and description.

[cols="1,3", options="header"]
|===
| Field                | Description
| `name`               | Primary name of the entity
| `nameTranslationKey` | Reference to name translation key for localization
| `description`        | Textual description of the entity
| `descTranslationKey` | Reference to description translation key for localization
| `slug`               | URL-friendly unique identifier derived from name
| `code`               | Optional system code for the entity (for integration purposes)
| `displayName`        | Optional formatted display name different from primary name
| `shortName`          | Optional abbreviated name for space-constrained displays
| `searchableText`     | Denormalized text optimized for full-text search
| `sortableName`       | Name form used for natural sorting (e.g., without articles)
|===

==== `MediaEntity`
Abstract base class for entities with associated media.

[cols="1,3", options="header"]
|===
| Field               | Description
| `primaryPhotoKey`   | Storage key for primary photo/image
| `photoKeys`         | Collection of storage keys for additional photos
| `videoKeys`         | Collection of storage keys for videos
| `documentKeys`      | Collection of storage keys for documents
| `thumbnailKey`      | Storage key for thumbnail image
| `coverImageKey`     | Storage key for cover image
| `totalStorageUsed`  | Total storage space used by media in bytes
| `mediaMetadata`     | JSON metadata about media files (dimensions, format, etc.)
| `lastMediaUpdate`   | Timestamp when media was last updated
| `mediaPermissions`  | Permission settings for associated media
| `cdnUrls`           | Precomputed CDN URLs for frequently accessed media
|===

==== `PublishableEntity`
Abstract base class for content that can be drafted, scheduled, published and unpublished.

[cols="1,3", options="header"]
|===
| Field                 | Description
| `publishStatus`       | Current publishing status (DRAFT, SCHEDULED, PUBLISHED, UNPUBLISHED)
| `publishedAt`         | Timestamp when the entity was published
| `publishedBy`         | Reference to the user who published the entity
| `unpublishedAt`       | Timestamp when the entity was unpublished
| `unpublishedBy`       | Reference to the user who unpublished the entity
| `scheduledPublishAt`  | Future timestamp when entity should be published
| `scheduledUnpublishAt`| Future timestamp when entity should be unpublished
| `autoPublish`         | Whether to automatically publish upon approval
| `publicationVersion`  | Version number of the current publication
| `publicationNotes`    | Notes related to publication decisions
| `highlightUntil`      | Date until which this entity should be highlighted as recently published
| `readyForReview`      | Flag indicating readiness for publication review
|===

==== `VersioningStrategy`
Enumeration for different approaches to content versioning.

[cols="1,3", options="header"]
|===
| Value                 | Description
| `MAJOR_MINOR`         | Traditional major.minor versioning (e.g., 1.0, 1.1, 2.0)
| `SEMANTIC`            | Semantic versioning with major.minor.patch (e.g., 1.0.0, 1.0.1)
| `DATE_BASED`          | Versions based on dates (e.g., 2023.1, 2023.2)
| `SEQUENTIAL`          | Simple sequential numbering (v1, v2, v3)
| `CUSTOM`              | Custom versioning strategy defined by application logic
|===

==== `ImportableEntity`
Interface for entities that can be imported from external systems.

[source,kotlin]
----
interface ImportableEntity {
    fun validateImportData(data: Map<String, Any>): ValidationResult
    fun mapExternalFields(externalData: Map<String, Any>): Map<String, Any>
    fun getImportHistory(): List<ImportRecord>
    fun resolveImportConflicts(conflicts: List<FieldConflict>): Resolution
    fun postImportProcess()
    fun getSourceSystemIdentifier(): String?
    fun getLastImportDate(): LocalDateTime?
}
----

==== `ExportableEntity`
Interface for entities that can be exported to various formats.

[source,kotlin]
----
interface ExportableEntity {
    fun toJson(options: ExportOptions): String
    fun toCsv(options: ExportOptions): String
    fun toXml(options: ExportOptions): String
    fun toPdf(options: ExportOptions): ByteArray
    fun getExportableFields(exportContext: ExportContext): List<String>
    fun getExportHistory(): List<ExportRecord>
    fun sanitizeForExport(securityContext: SecurityContext): ExportableEntity
    fun enrichForExport(enrichmentContext: EnrichmentContext): ExportableEntity
}
----

==== `BatchProcessable`
Interface for entities that can be processed in bulk operations.

[source,kotlin]
----
interface BatchProcessable {
    fun validateBatchOperation(operation: BatchOperation): ValidationResult
    fun processBatch(items: List<BatchItem>, operation: BatchOperation): BatchResult
    fun getAvailableBatchOperations(): List<BatchOperation>
    fun getBatchProcessingHistory(): List<BatchProcessRecord>
    fun estimateBatchProcessingTime(itemCount: Int, operation: BatchOperation): Duration
    fun supportsConcurrentBatchProcessing(): Boolean
}
----

==== `ReferenceDataEntity`
Abstract base class for lookup tables and reference data with effective dates.

[cols="1,3", options="header"]
|===
| Field                 | Description
| `code`                | Unique code for this reference data item
| `category`            | Category or group this reference data belongs to
| `effectiveFrom`       | Date from which this reference data is effective
| `effectiveTo`         | Date until which this reference data is effective
| `isDefault`           | Whether this is the default value in its category
| `sortOrder`           | Numeric value for controlling display ordering
| `replacedBy`          | Reference to newer version that replaces this item
| `sourceSystem`        | System of record for this reference data
| `validationRules`     | JSON rules for validating usage of this reference data
| `metadataSchema`      | JSON schema for additional metadata on this reference item
| `isActive`            | Whether this reference data item is currently active
| `deprecationNotes`    | Notes on why an item is deprecated or replaced
|===

==== `ExternalSystemSyncable`
Interface for entities that synchronize with external systems.

[source,kotlin]
----
interface ExternalSystemSyncable {
    fun getExternalSystemId(): String
    fun getExternalSystemUrl(): URL
    fun getLastSyncTime(): LocalDateTime
    fun getSyncStatus(): SyncStatus
    fun markForSync(priority: SyncPriority = SyncPriority.NORMAL)
    fun getSyncConflicts(): List<SyncConflict>
    fun resolveSyncConflict(conflict: SyncConflict, resolution: ConflictResolution)
    fun getSyncHistory(): List<SyncEvent>
    fun getDataMappingRules(): Map<String, String>
}
----

==== `WebhookTriggerable`
Interface for entities that can trigger webhooks on state changes.

[source,kotlin]
----
interface WebhookTriggerable {
    fun getRegisteredWebhooks(): List<WebhookRegistration>
    fun registerWebhook(endpoint: URL, events: Set<String>, secret: String): WebhookRegistration
    fun unregisterWebhook(registrationId: String)
    fun triggerWebhooks(event: String, payload: Map<String, Any>)
    fun getWebhookHistory(): List<WebhookEvent>
    fun validateWebhookPayload(payload: Map<String, Any>): Boolean
    fun getFailedWebhookAttempts(): List<FailedWebhookAttempt>
}
----

==== `ComplianceAuditable`
Interface for tracking specific compliance requirements.

[source,kotlin]
----
interface ComplianceAuditable {
    fun getComplianceFrameworks(): Set<ComplianceFramework>
    fun getComplianceStatus(framework: ComplianceFramework): ComplianceStatus
    fun getComplianceAuditTrail(): List<ComplianceAuditEvent>
    fun getRequiredAttestations(): List<ComplianceAttestation>
    fun attestCompliance(attestation: ComplianceAttestation, user: User): AttestationResult
    fun getComplianceDocumentation(): List<ComplianceDocument>
    fun validateComplianceState(): ValidationResult
}
----

==== `DataRetentionPolicy`
Entity for managing data lifecycle according to regulations.

[cols="1,3", options="header"]
|===
| Field                     | Description
| `policyName`              | Name of the retention policy
| `retentionPeriodDays`     | Number of days to retain data
| `legalBasis`              | Legal basis for retention period
| `dataCategories`          | Categories of data this policy applies to
| `actionAfterRetention`    | Action to take after retention (DELETE, ANONYMIZE, ARCHIVE)
| `notificationPeriodDays`  | Days before retention action to notify stakeholders
| `exemptionCriteria`       | Criteria for exempting data from this policy
| `lastReviewDate`          | When policy was last reviewed
| `effectiveDate`           | When policy became effective
| `policyOwner`             | Person/role responsible for this policy
| `regulatoryReferences`    | References to regulations this policy satisfies
| `isActive`                | Whether this policy is currently active
|===

==== `AnalyticsTrackable`
Interface for entities that need usage statistics tracking.

[source,kotlin]
----
interface AnalyticsTrackable {
    fun recordView(user: User?, context: ViewContext)
    fun recordInteraction(type: InteractionType, user: User?, metadata: Map<String, Any>)
    fun getViewCount(): Int
    fun getUniqueViewerCount(): Int
    fun getViewsByPeriod(period: AnalyticsPeriod): Map<LocalDate, Int>
    fun getPopularityScore(): Double
    fun getInteractionRatios(): Map<InteractionType, Double>
    fun getConversionEvents(): List<ConversionEvent>
    fun resetAnalytics()
}
----

==== `CustomValidatable`
Interface for entities with complex business rule validations.

[source,kotlin]
----
interface CustomValidatable {
    fun validate(): ValidationResult
    fun getValidationRules(): List<ValidationRule>
    fun addValidationRule(rule: ValidationRule)
    fun removeValidationRule(ruleId: String)
    fun getValidationHistory(): List<ValidationEvent>
    fun validateField(fieldName: String, value: Any?): FieldValidationResult
    fun runCustomValidation(validationId: String, context: Map<String, Any>): ValidationResult
    fun getActiveValidators(): List<Validator>
}
----

==== `FullTextSearchable`
Interface with additional fields for optimizing search capabilities.

[source,kotlin]
----
interface FullTextSearchable {
    fun getSearchableContent(): Map<String, String>
    fun getSearchKeywords(): Set<String>
    fun getSearchBoostFactors(): Map<String, Double>
    fun getSearchFacets(): Map<String, Set<String>>
    fun getSearchSynonyms(): Map<String, Set<String>>
    fun indexForSearch()
    fun getSuggestedSearchQueries(): List<String>
    fun getSearchRelevanceScore(query: String): Double
    fun updateSearchMetadata(metadata: Map<String, Any>)
}
----

==== `FaultTolerant`
Interface with strategies for handling recovery from system failures.

[source,kotlin]
----
interface FaultTolerant {
    fun createRecoveryCheckpoint(): RecoveryCheckpoint
    fun restoreFromCheckpoint(checkpoint: RecoveryCheckpoint): RecoveryResult
    fun getAvailableCheckpoints(): List<RecoveryCheckpoint>
    fun validateChecksumIntegrity(): Boolean
    fun getLastKnownGoodState(): RecoveryState
    fun getRecoveryLogs(): List<RecoveryLog>
    fun runSelfRepair(options: RepairOptions): RepairResult
    fun isInCorruptedState(): Boolean
    fun getCorruptionDetails(): CorruptionReport?
}
----

==== `TenantAware`
Mixin interface for entities that support multi-tenancy.

[cols="1,3", options="header"]
|===
| Field                | Description
| `tenant`             | Reference to the tenant this entity belongs to
| `tenantPath`         | Hierarchical path in tenant tree for nested tenancy
| `crossTenantVisible` | Whether this entity is visible across tenants
| `tenantSpecificRules`| JSON configuration for tenant-specific behaviors
|===

==== `Cacheable`
Mixin interface for entities supporting cache optimization.

[cols="1,3", options="header"]
|===
| Field                | Description
| `cacheKey`           | Unique key for caching this entity
| `cacheExpiresAt`     | When cached entity should expire
| `cacheVersion`       | Version identifier for cache invalidation
| `lastCacheInvalidation` | Timestamp when cache was last invalidated
|===

==== `AuditableAction`
Records specific actions performed on entities for comprehensive audit trails.

[cols="1,3", options="header"]
|===
| Field           | Description
| `actionType`    | Type of action performed (CREATE, READ, UPDATE, DELETE, APPROVE, etc.)
| `entityType`    | Type of entity on which the action was performed
| `entityId`      | ID of the entity on which the action was performed
| `performedBy`   | User who performed the action
| `performedAt`   | Timestamp when the action was performed
| `ipAddress`     | IP address from which the action was initiated
| `userAgent`     | User agent information from which the action was initiated
| `changes`       | JSON representation of changes made (for UPDATE actions)
| `notes`         | Optional notes providing context about the action
| `sessionId`     | Session identifier for tracking user journey
| `transactionId` | Correlation ID for grouping related operations
| `applicationModule` | Module or component where action originated
| `success`       | Whether the action completed successfully
| `duration`      | Time taken to complete the action in milliseconds
| `riskLevel`     | Assessed risk level of the action (LOW, MEDIUM, HIGH)
|===

==== `AddressComponent`
Embeddable component for structured address information.

[cols="1,3", options="header"]
|===
| Field                 | Description
| `provinceCode`        | Reference code to province/state
| `districtCode`        | Reference code to district/county
| `municipalityCode`    | Reference code to municipality/city
| `wardNumber`          | Ward number within the municipality
| `wardMunicipalityCode`| Combined ward and municipality reference
| `streetAddress`       | Detailed street address
| `postalCode`          | Postal/ZIP code
| `formattedAddress`    | Complete formatted address string
| `addressType`         | Type of address (e.g., PERMANENT, TEMPORARY, BUSINESS)
| `validatedAt`         | When address was last validated
| `validatedMethod`     | Method used for address validation
| `geoCodedAt`          | When address was last geocoded
| `geoAccuracy`         | Accuracy of geocoding in meters
| `deliveryNotes`       | Special instructions for physical delivery
| `isActive`            | Whether this address is currently active
|===

==== `ContactInformation`
Embeddable component for contact details.

[cols="1,3", options="header"]
|===
| Field                | Description
| `email`              | Primary email address
| `alternateEmail`     | Secondary email address
| `phoneNumber`        | Primary phone number
| `mobileNumber`       | Mobile phone number
| `faxNumber`          | Fax number
| `websiteUrl`         | Website URL
| `socialMediaUrls`    | Collection of social media profile URLs
| `preferredContactMethod` | Preferred way to contact (EMAIL, PHONE, SMS, etc.)
| `contactAvailability`| JSON representation of availability windows
| `emailVerified`      | Whether primary email has been verified
| `phoneVerified`      | Whether primary phone has been verified
| `lastVerificationAttempt` | Timestamp of last verification attempt
| `verificationExpiry` | When current verification expires
| `doNotContact`       | Whether entity has requested no contact
|===

==== `SEOAttributes`
Embeddable component for search engine optimization data.

[cols="1,3", options="header"]
|===
| Field               | Description
| `metaTitle`         | Custom SEO title (falls back to entity name if not specified)
| `metaDescription`   | SEO meta description
| `metaKeywords`      | SEO meta keywords
| `canonicalUrl`      | Canonical URL for this entity
| `ogTitle`           | Open Graph title for social sharing
| `ogDescription`     | Open Graph description for social sharing
| `ogImageKey`        | Storage key for Open Graph image
| `twitterCardType`   | Twitter card type (summary, summary_large_image, etc.)
| `structuredData`    | JSON-LD structured data for rich search results
| `indexingDirectives`| Search engine indexing directives (noindex, nofollow, etc.)
| `lastIndexedAt`     | When search engines last indexed this entity
| `searchRank`        | Custom search ranking boost factor
| `sitemapPriority`   | Priority for inclusion in sitemap (0.0-1.0)
| `sitemapChangeFreq` | Change frequency for sitemap (hourly, daily, weekly, etc.)
|===

==== `OperationalHours`
Embeddable component for storing operational hours information.

[cols="1,3", options="header"]
|===
| Field               | Description
| `dayOfWeek`         | Day of the week (MONDAY, TUESDAY, etc.)
| `openTime`          | Opening time
| `closeTime`         | Closing time
| `isClosed`          | Whether the entity is closed on this day
| `breakStartTime`    | Start time for break/lunch period
| `breakEndTime`      | End time for break/lunch period
| `specialNotes`      | Any special notes about operations on this day
| `isHoliday`         | Whether this day is a recurring holiday
| `seasonalAdjustment`| Adjustment for seasonal hours changes
| `timeZone`          | Time zone for these operational hours
|===

==== `EventSourcingCapable`
Interface for entities supporting event sourcing pattern.

[source,kotlin]
----
interface EventSourcingCapable {
    fun getEventStream(): List<DomainEvent>
    fun applyEvent(event: DomainEvent)
    fun getCurrentState(): Map<String, Any>
    fun rebuildFromEvents(events: List<DomainEvent>)
    fun getLastEventSequence(): Long
}
----

==== `DomainEvent`
Base class for domain events in event sourcing.

[cols="1,3", options="header"]
|===
| Field               | Description
| `eventId`           | Unique identifier for the event
| `entityId`          | ID of the entity this event relates to
| `entityType`        | Type of entity this event relates to
| `eventType`         | Type of event (entity-specific)
| `timestamp`         | When the event occurred
| `actorId`           | User who triggered the event
| `sequenceNumber`    | Sequential number for ordering events
| `payload`           | JSON payload containing event details
| `metadata`          | Additional contextual metadata
| `version`           | Schema version of the event
|===

==== `TaggableEntity`
Mixin interface for entities that can be tagged for categorization.

[cols="1,3", options="header"]
|===
| Field     | Description
| `tags`    | Collection of tags associated with the entity
|===

==== `Taggable`
Interface marking an entity as taggable with methods for tag management.

[source,kotlin]
----
interface Taggable {
    fun getTags(): Set<Tag>
    fun addTag(tag: Tag)
    fun removeTag(tag: Tag)
    fun hasTag(tagName: String): Boolean
    fun getTagsByCategory(category: String): Set<Tag>
    fun getTagsAsString(): String
    fun setTagsFromString(tagString: String, delimiter: String = ",")
    fun clearAllTags()
}
----

==== `Tag`
Represents a categorization tag that can be applied to entities.

[cols="1,3", options="header"]
|===
| Field          | Description
| `name`         | Name of the tag
| `description`  | Optional description of the tag
| `category`     | Optional category for grouping related tags
| `slug`         | URL-friendly version of the tag name
| `color`        | Optional color code for visual representation
| `icon`         | Optional icon identifier for visual representation
| `parentTag`    | Optional reference to parent tag for hierarchical tagging
| `weight`       | Optional weight for controlling tag importance/ordering
| `createdBy`    | User who created this tag
| `isSystemTag`  | Whether this is a system-defined tag (vs. user-defined)
| `usageCount`   | Number of entities using this tag
|===

==== `Subscribable`
Interface for entities that support subscription capabilities.

[source,kotlin]
----
interface Subscribable {
    fun getSubscribers(): Set<User>
    fun addSubscriber(user: User, notificationType: NotificationType)
    fun removeSubscriber(user: User)
    fun notifySubscribers(eventType: String, data: Map<String, Any>)
    fun isUserSubscribed(user: User): Boolean
}
----

==== `NotificationType`
Enumeration for types of notifications users can subscribe to.

[cols="1,3", options="header"]
|===
| Value                | Description
| `ALL_CHANGES`        | Notify on all entity changes
| `MAJOR_CHANGES`      | Notify only on significant changes
| `STATUS_CHANGES`     | Notify only on status/state changes
| `COMMENTS_ONLY`      | Notify only when comments are added
| `APPROVALS_ONLY`     | Notify only for approval events
| `MENTIONS`           | Notify only when user is mentioned
| `DIGEST`             | Periodic digest of all changes
|===

==== `AccessControlled`
Interface for entities with fine-grained access control.

[source,kotlin]
----
interface AccessControlled {
    fun getOwner(): User
    fun getAccessControlList(): Set<AccessControlEntry>
    fun hasPermission(user: User, permission: Permission): Boolean
    fun grantPermission(user: User, permission: Permission)
    fun revokePermission(user: User, permission: Permission)
    fun getEffectivePermissions(user: User): Set<Permission>
}
----

==== `AccessControlEntry`
Represents a permission assignment for an entity.

[cols="1,3", options="header"]
|===
| Field           | Description
| `entity`        | Entity this ACE applies to
| `principal`     | User or group this entry applies to
| `permission`    | Permission being granted
| `grantedBy`     | User who granted this permission
| `grantedAt`     | When this permission was granted
| `expiresAt`     | When this permission expires (if temporary)
| `conditions`    | Optional conditions for when permission applies
|===

==== `Permission`
Enumeration of possible permissions for access control.

[cols="1,3", options="header"]
|===
| Value          | Description
| `VIEW`         | Permission to view/read the entity
| `EDIT`         | Permission to modify the entity
| `DELETE`       | Permission to delete the entity
| `APPROVE`      | Permission to approve/reject the entity
| `SHARE`        | Permission to share the entity with others
| `EXPORT`       | Permission to export the entity
| `ADMIN`        | Full administrative control of the entity
| `COMMENT`      | Permission to add comments
|===

==== `HistoryViewable`
Interface for entities that provide a comprehensive view of historical changes.

[source,kotlin]
----
interface HistoryViewable {
    fun getChangeHistory(): List<ChangeRecord>
    fun getHistorySnapshot(timestamp: LocalDateTime): Map<String, Any>
    fun compareSnapshots(timestamp1: LocalDateTime, timestamp2: LocalDateTime): ChangeComparison
    fun getHistoryTimeline(): List<HistoryEvent>
    fun getFieldHistory(fieldName: String): List<FieldChangeRecord>
    fun getContributors(): List<User>
    fun getMajorVersions(): List<VersionInfo>
    fun restoreToVersion(versionId: String): RestoreResult
    fun getActivityHeatmap(startDate: LocalDate, endDate: LocalDate): Map<LocalDate, Int>
}
----

==== `WorkflowEntity`
Abstract base class for entities that follow a business process workflow.

[cols="1,3", options="header"]
|===
| Field                 | Description
| `workflowDefinitionId`| Reference to the workflow definition this entity follows
| `workflowInstanceId`  | Identifier for this specific workflow instance
| `currentState`        | Current state in the workflow process
| `previousStates`      | Collection of previous states this entity has been through
| `nextPossibleStates`  | Collection of potential next states based on current state
| `stateEnteredAt`      | Timestamp when the current state was entered
| `stateDeadline`       | Optional deadline for completing the current state
| `assignee`            | User currently assigned to handle this workflow state
| `watchers`            | Collection of users monitoring this workflow
| `workflowStartedAt`   | When this workflow instance was initiated
| `workflowCompletedAt` | When this workflow instance was completed (if finished)
| `workflowData`        | JSON data specific to this workflow instance
| `stateTransitionHistory` | History of state transitions with timestamps and actors
| `activeTaskIds`       | IDs of active tasks that must be completed in current state
| `workflowPriority`    | Priority level for this workflow instance
|===

==== `EncryptedEntity`
Abstract base class for entities containing encrypted sensitive data.

[cols="1,3", options="header"]
|===
| Field                | Description
| `encryptionKeyId`    | Reference to the encryption key used for this entity
| `encryptionAlgorithm`| Algorithm used for encryption
| `encryptedFields`    | List of fields that are encrypted
| `encryptionVersion`  | Version of encryption scheme used
| `lastReencryptedAt`  | When the entity was last re-encrypted
| `encryptionContext`  | Context information needed for decryption
| `dataClassification` | Classification level of contained data (e.g., PUBLIC, CONFIDENTIAL, SECRET)
| `decryptionAuditLog` | Log of when the entity was decrypted and by whom
| `keyRotationDue`     | Date when encryption key rotation is due
| `encryptionMetadata` | Additional metadata about encryption process
| `hashOfOriginal`     | Hash of original unencrypted data for integrity checks
|===

==== `BiometricVerifiable`
Interface for entities that can be verified using biometric data.

[source,kotlin]
----
interface BiometricVerifiable {
    fun getBiometricVerificationTypes(): Set<BiometricType>
    fun isBiometricallyVerified(type: BiometricType): Boolean
    fun getBiometricVerificationStatus(): VerificationStatus
    fun getLastVerificationAttempt(): BiometricVerificationAttempt?
    fun recordVerificationAttempt(attempt: BiometricVerificationAttempt)
    fun getBiometricVerificationHistory(): List<BiometricVerificationAttempt>
    fun getRequiredVerificationLevel(): VerificationLevel
    fun getVerificationExpiry(type: BiometricType): LocalDateTime?
    fun clearBiometricVerifications(reason: String, performedBy: User)
}
----

==== `BiometricType`
Enumeration of supported biometric verification methods.

[cols="1,3", options="header"]
|===
| Value               | Description
| `FINGERPRINT`       | Fingerprint scanning verification
| `FACIAL_RECOGNITION`| Facial recognition verification
| `IRIS_SCAN`         | Iris pattern scanning verification
| `VOICE_RECOGNITION` | Voice pattern recognition verification
| `SIGNATURE`         | Digital signature verification
| `PALM_VEIN`         | Palm vein pattern verification
| `RETINA_SCAN`       | Retina scanning verification
| `GAIT_ANALYSIS`     | Walking pattern analysis verification
| `HAND_GEOMETRY`     | Hand shape and structure verification
|===

==== `MobileAccessible`
Interface for entities that support mobile access with additional context.

[source,kotlin]
----
interface MobileAccessible {
    fun getMobileViewConfiguration(): MobileViewConfig
    fun getOfflineCapabilities(): Set<OfflineCapability>
    fun getLastMobileAccess(): MobileAccessRecord?
    fun getMobileAccessHistory(): List<MobileAccessRecord>
    fun getLocationRequirements(): LocationRequirement?
    fun isSupportedOnMobileVersion(version: String): Boolean
    fun getMobileSyncStatus(): SyncStatus
    fun getFallbackDisplayMode(): MobileDisplayMode
    fun prepareForOfflineAccess(): OfflinePackage
    fun getEstimatedMobileDataUsage(): Long
    fun getRequiredMobilePermissions(): Set<MobilePermission>
}
----

==== `OfflineCapability`
Enumeration of capabilities available in offline mode.

[cols="1,3", options="header"]
|===
| Value               | Description
| `VIEW_ONLY`         | Can only view entity content when offline
| `EDIT`              | Can edit entity while offline
| `CREATE_NEW`        | Can create new entities while offline
| `DELETE`            | Can delete entities while offline
| `SUBMIT`            | Can submit forms/changes while offline (will sync later)
| `PARTIAL_CONTENT`   | Only critical content available offline
| `FULL_CONTENT`      | All entity content available offline
| `MEDIA_EXCLUDED`    | All media assets excluded from offline access
| `LOW_RES_MEDIA`     | Only low-resolution media available offline
|===
