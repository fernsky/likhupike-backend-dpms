==== Capability Interfaces

===== `AccessControlled`
Interface for entities with fine-grained access control.

[source,kotlin]
----
interface AccessControlled {
    fun getOwner(): User
    fun getAccessControlList(): Set<AccessControlEntry>
    fun hasPermission(user: User, permission: Permission): Boolean
    fun grantPermission(user: User, permission: Permission)
    fun revokePermission(user: User, permission: Permission)
    fun getEffectivePermissions(user: User): Set<Permission>
}
----

===== `Permission`
Enumeration of possible permissions for access control.

[cols="1,3", options="header"]
|===
| Value          | Description
| `VIEW`         | Permission to view/read the entity
| `EDIT`         | Permission to modify the entity
| `DELETE`       | Permission to delete the entity
| `APPROVE`      | Permission to approve/reject the entity
| `SHARE`        | Permission to share the entity with others
| `EXPORT`       | Permission to export the entity
| `ADMIN`        | Full administrative control of the entity
| `COMMENT`      | Permission to add comments
|===

===== `HistoryViewable`
Interface for entities that provide a comprehensive view of historical changes.

[source,kotlin]
----
interface HistoryViewable {
    fun getChangeHistory(): List<ChangeRecord>
    fun getHistorySnapshot(timestamp: LocalDateTime): Map<String, Any>
    fun compareSnapshots(timestamp1: LocalDateTime, timestamp2: LocalDateTime): ChangeComparison
    fun getHistoryTimeline(): List<HistoryEvent>
    fun getFieldHistory(fieldName: String): List<FieldChangeRecord>
    fun getContributors(): List<User>
    fun getMajorVersions(): List<VersionInfo>
    fun restoreToVersion(versionId: String): RestoreResult
    fun getActivityHeatmap(startDate: LocalDate, endDate: LocalDate): Map<LocalDate, Int>
}
----

===== `Taggable`
Interface marking an entity as taggable with methods for tag management.

[source,kotlin]
----
interface Taggable {
    fun getTags(): Set<Tag>
    fun addTag(tag: Tag)
    fun removeTag(tag: Tag)
    fun hasTag(tagName: String): Boolean
    fun getTagsByCategory(category: String): Set<Tag>
    fun getTagsAsString(): String
    fun setTagsFromString(tagString: String, delimiter: String = ",")
    fun clearAllTags()
}
----

===== `Subscribable`
Interface for entities that support subscription capabilities.

[source,kotlin]
----
interface Subscribable {
    fun getSubscribers(): Set<User>
    fun addSubscriber(user: User, notificationType: NotificationType)
    fun removeSubscriber(user: User)
    fun notifySubscribers(eventType: String, data: Map<String, Any>)
    fun isUserSubscribed(user: User): Boolean
}
----

===== `NotificationType`
Enumeration for types of notifications users can subscribe to.

[cols="1,3", options="header"]
|===
| Value                | Description
| `ALL_CHANGES`        | Notify on all entity changes
| `MAJOR_CHANGES`      | Notify only on significant changes
| `STATUS_CHANGES`     | Notify only on status/state changes
| `COMMENTS_ONLY`      | Notify only when comments are added
| `APPROVALS_ONLY`     | Notify only for approval events
| `MENTIONS`           | Notify only when user is mentioned
| `DIGEST`             | Periodic digest of all changes
|===

===== `EventSourcingCapable`
Interface for entities supporting event sourcing pattern.

[source,kotlin]
----
interface EventSourcingCapable {
    fun getEventStream(): List<DomainEvent>
    fun applyEvent(event: DomainEvent)
    fun getCurrentState(): Map<String, Any>
    fun rebuildFromEvents(events: List<DomainEvent>)
    fun getLastEventSequence(): Long
}
----

===== `BiometricVerifiable`
Interface for entities that can be verified using biometric data.

[source,kotlin]
----
interface BiometricVerifiable {
    fun getBiometricVerificationTypes(): Set<BiometricType>
    fun isBiometricallyVerified(type: BiometricType): Boolean
    fun getBiometricVerificationStatus(): VerificationStatus
    fun getLastVerificationAttempt(): BiometricVerificationAttempt?
    fun recordVerificationAttempt(attempt: BiometricVerificationAttempt)
    fun getBiometricVerificationHistory(): List<BiometricVerificationAttempt>
    fun getRequiredVerificationLevel(): VerificationLevel
    fun getVerificationExpiry(type: BiometricType): LocalDateTime?
    fun clearBiometricVerifications(reason: String, performedBy: User)
}
----

===== `BiometricType`
Enumeration of supported biometric verification methods.

[cols="1,3", options="header"]
|===
| Value               | Description
| `FINGERPRINT`       | Fingerprint scanning verification
| `FACIAL_RECOGNITION`| Facial recognition verification
| `IRIS_SCAN`         | Iris pattern scanning verification
| `VOICE_RECOGNITION` | Voice pattern recognition verification
| `SIGNATURE`         | Digital signature verification
| `PALM_VEIN`         | Palm vein pattern verification
| `RETINA_SCAN`       | Retina scanning verification
| `GAIT_ANALYSIS`     | Walking pattern analysis verification
| `HAND_GEOMETRY`     | Hand shape and structure verification
|===

===== `MobileAccessible`
Interface for entities that support mobile access with additional context.

[source,kotlin]
----
interface MobileAccessible {
    fun getMobileViewConfiguration(): MobileViewConfig
    fun getOfflineCapabilities(): Set<OfflineCapability>
    fun getLastMobileAccess(): MobileAccessRecord?
    fun getMobileAccessHistory(): List<MobileAccessRecord>
    fun getLocationRequirements(): LocationRequirement?
    fun isSupportedOnMobileVersion(version: String): Boolean
    fun getMobileSyncStatus(): SyncStatus
    fun getFallbackDisplayMode(): MobileDisplayMode
    fun prepareForOfflineAccess(): OfflinePackage
    fun getEstimatedMobileDataUsage(): Long
    fun getRequiredMobilePermissions(): Set<MobilePermission>
}
----

===== `OfflineCapability`
Enumeration of capabilities available in offline mode.

[cols="1,3", options="header"]
|===
| Value               | Description
| `VIEW_ONLY`         | Can only view entity content when offline
| `EDIT`              | Can edit entity while offline
| `CREATE_NEW`        | Can create new entities while offline
| `DELETE`            | Can delete entities while offline
| `SUBMIT`            | Can submit forms/changes while offline (will sync later)
| `PARTIAL_CONTENT`   | Only critical content available offline
| `FULL_CONTENT`      | All entity content available offline
| `MEDIA_EXCLUDED`    | All media assets excluded from offline access
| `LOW_RES_MEDIA`     | Only low-resolution media available offline
|===

===== `FullTextSearchable`
Interface with additional fields for optimizing search capabilities.

[source,kotlin]
----
interface FullTextSearchable {
    fun getSearchableContent(): Map<String, String>
    fun getSearchKeywords(): Set<String>
    fun getSearchBoostFactors(): Map<String, Double>
    fun getSearchFacets(): Map<String, Set<String>>
    fun getSearchSynonyms(): Map<String, Set<String>>
    fun indexForSearch()
    fun getSuggestedSearchQueries(): List<String>
    fun getSearchRelevanceScore(query: String): Double
    fun updateSearchMetadata(metadata: Map<String, Any>)
}
----

===== `ImportableEntity`
Interface for entities that can be imported from external systems.

[source,kotlin]
----
interface ImportableEntity {
    fun validateImportData(data: Map<String, Any>): ValidationResult
    fun mapExternalFields(externalData: Map<String, Any>): Map<String, Any>
    fun getImportHistory(): List<ImportRecord>
    fun resolveImportConflicts(conflicts: List<FieldConflict>): Resolution
    fun postImportProcess()
    fun getSourceSystemIdentifier(): String?
    fun getLastImportDate(): LocalDateTime?
}
----

===== `ExportableEntity`
Interface for entities that can be exported to various formats.

[source,kotlin]
----
interface ExportableEntity {
    fun toJson(options: ExportOptions): String
    fun toCsv(options: ExportOptions): String
    fun toXml(options: ExportOptions): String
    fun toPdf(options: ExportOptions): ByteArray
    fun getExportableFields(exportContext: ExportContext): List<String>
    fun getExportHistory(): List<ExportRecord>
    fun sanitizeForExport(securityContext: SecurityContext): ExportableEntity
    fun enrichForExport(enrichmentContext: EnrichmentContext): ExportableEntity
}
----

===== `BatchProcessable`
Interface for entities that can be processed in bulk operations.

[source,kotlin]
----
interface BatchProcessable {
    fun validateBatchOperation(operation: BatchOperation): ValidationResult
    fun processBatch(items: List<BatchItem>, operation: BatchOperation): BatchResult
    fun getAvailableBatchOperations(): List<BatchOperation>
    fun getBatchProcessingHistory(): List<BatchProcessRecord>
    fun estimateBatchProcessingTime(itemCount: Int, operation: BatchOperation): Duration
    fun supportsConcurrentBatchProcessing(): Boolean
}
----

===== `CustomValidatable`
Interface for entities with complex business rule validations.

[source,kotlin]
----
interface CustomValidatable {
    fun validate(): ValidationResult
    fun getValidationRules(): List<ValidationRule>
    fun addValidationRule(rule: ValidationRule)
    fun removeValidationRule(ruleId: String)
    fun getValidationHistory(): List<ValidationEvent>
    fun validateField(fieldName: String, value: Any?): FieldValidationResult
    fun runCustomValidation(validationId: String, context: Map<String, Any>): ValidationResult
    fun getActiveValidators(): List<Validator>
}
----

===== `FaultTolerant`
Interface with strategies for handling recovery from system failures.

[source,kotlin]
----
interface FaultTolerant {
    fun createRecoveryCheckpoint(): RecoveryCheckpoint
    fun restoreFromCheckpoint(checkpoint: RecoveryCheckpoint): RecoveryResult
    fun getAvailableCheckpoints(): List<RecoveryCheckpoint>
    fun validateChecksumIntegrity(): Boolean
    fun getLastKnownGoodState(): RecoveryState
    fun getRecoveryLogs(): List<RecoveryLog>
    fun runSelfRepair(options: RepairOptions): RepairResult
    fun isInCorruptedState(): Boolean
    fun getCorruptionDetails(): CorruptionReport?
}
----

===== `AnalyticsTrackable`
Interface for entities that need usage statistics tracking.

[source,kotlin]
----
interface AnalyticsTrackable {
    fun recordView(user: User?, context: ViewContext)
    fun recordInteraction(type: InteractionType, user: User?, metadata: Map<String, Any>)
    fun getViewCount(): Int
    fun getUniqueViewerCount(): Int
    fun getViewsByPeriod(period: AnalyticsPeriod): Map<LocalDate, Int>
    fun getPopularityScore(): Double
    fun getInteractionRatios(): Map<InteractionType, Double>
    fun getConversionEvents(): List<ConversionEvent>
    fun resetAnalytics()
}
----

===== `ComplianceAuditable`
Interface for tracking specific compliance requirements.

[source,kotlin]
----
interface ComplianceAuditable {
    fun getComplianceFrameworks(): Set<ComplianceFramework>
    fun getComplianceStatus(framework: ComplianceFramework): ComplianceStatus
    fun getComplianceAuditTrail(): List<ComplianceAuditEvent>
    fun getRequiredAttestations(): List<ComplianceAttestation>
    fun attestCompliance(attestation: ComplianceAttestation, user: User): AttestationResult
    fun getComplianceDocumentation(): List<ComplianceDocument>
    fun validateComplianceState(): ValidationResult
}
----

===== `ExternalSystemSyncable`
Interface for entities that synchronize with external systems.

[source,kotlin]
----
interface ExternalSystemSyncable {
    fun getExternalSystemId(): String
    fun getExternalSystemUrl(): URL
    fun getLastSyncTime(): LocalDateTime
    fun getSyncStatus(): SyncStatus
    fun markForSync(priority: SyncPriority = SyncPriority.NORMAL)
    fun getSyncConflicts(): List<SyncConflict>
    fun resolveSyncConflict(conflict: SyncConflict, resolution: ConflictResolution)
    fun getSyncHistory(): List<SyncEvent>
    fun getDataMappingRules(): Map<String, String>
}
----

===== `WebhookTriggerable`
Interface for entities that can trigger webhooks on state changes.

[source,kotlin]
----
interface WebhookTriggerable {
    fun getRegisteredWebhooks(): List<WebhookRegistration>
    fun registerWebhook(endpoint: URL, events: Set<String>, secret: String): WebhookRegistration
    fun unregisterWebhook(registrationId: String)
    fun triggerWebhooks(event: String, payload: Map<String, Any>)
    fun getWebhookHistory(): List<WebhookEvent>
    fun validateWebhookPayload(payload: Map<String, Any>): Boolean
    fun getFailedWebhookAttempts(): List<FailedWebhookAttempt>
}
----

===== `GeocodingCapable`
Interface for entities that can resolve geographic locations from text descriptions.

[source,kotlin]
----
interface GeocodingCapable {
    fun geocodeAddress(addressText: String): GeocodingResult
    fun reverseGeocode(longitude: Double, latitude: Double): AddressComponent
    fun validateAddress(addressComponent: AddressComponent): AddressValidationResult
    fun getAddressSuggestions(partialAddress: String): List<AddressSuggestion>
    fun resolveLocation(locationDescriptor: String): List<LocationMatch>
    fun calculateDistance(address1: AddressComponent, address2: AddressComponent): Double
}
----

===== `TenantAware`
Mixin interface for entities that support multi-tenancy.

[cols="1,3", options="header"]
|===
| Field                | Description
| `tenant`             | Reference to the tenant this entity belongs to
| `tenantPath`         | Hierarchical path in tenant tree for nested tenancy
| `crossTenantVisible` | Whether this entity is visible across tenants
| `tenantSpecificRules`| JSON configuration for tenant-specific behaviors
|===

===== `Cacheable`
Mixin interface for entities supporting cache optimization.

[cols="1,3", options="header"]
|===
| Field                | Description
| `cacheKey`           | Unique key for caching this entity
| `cacheExpiresAt`     | When cached entity should expire
| `cacheVersion`       | Version identifier for cache invalidation
| `lastCacheInvalidation` | Timestamp when cache was last invalidated
|===
